import json

from apps.explorer import cele
from channels.layers import get_channel_layer
from asgiref.sync import async_to_sync

import os

# data={'block': {'hash': '0xb1db50933337ebb0648a989fa82ffbe93da899fddeb12d612e4085cfd1f53f00',
#            'id': 245050,
#            'producerID': '0x7170f578ca82897375f009ddea399df08f31bcff',
#            'reward': '12.6517568',
#            'timestamp': 1556239424.944,
#            'txs': 4},
#  'header': {'blockHeight': 245049,
#             'bps': 0.0,
#             'committee': '12th',
#             'proposer': '12',
#             'rnode': 6,
#             'tps': 0.0,
#             'txs': 503007},
#  'txs': [{'amount': '0.0004392000',
#           'buyerID': '0xab6a0a80c9c3f288f02acaa39343d794a5c5006a',
#           'hash': '0x1780f31192932aec0839fc8435c065cc578e93ebd96537f2fea3f8a19bcd8278',
#           'sellerID': '0x5ea101f05fe790d8b2678c01d0d161ba6b162a88',
#           'timestamp': 1556239384.944},
#          {'amount': '0.0004380480',
#           'buyerID': '0xab6a0a80c9c3f288f02acaa39343d794a5c5006a',
#           'hash': '0xaeb3e77f208fcac822349b321ff013fb1985120c2ef6663dc91049c53ca73773',
#           'sellerID': '0x5ea101f05fe790d8b2678c01d0d161ba6b162a88',
#           'timestamp': 1556239384.944},
#          {'amount': '0.0004380480',
#           'buyerID': '0xab6a0a80c9c3f288f02acaa39343d794a5c5006a',
#           'hash': '0x8dc2e7009c6de7a2263be6c1d0d6121b7696d793d428f5b111d5e240dd6cb5ee',
#           'sellerID': '0x5ea101f05fe790d8b2678c01d0d161ba6b162a88',
#           'timestamp': 1556239384.944},
#          {'amount': '0.0004392000',
#           'buyerID': '0xab6a0a80c9c3f288f02acaa39343d794a5c5006a',
#           'hash': '0x35bcc51733e54e0d2c66ab517303e4d1d6f01aa534b4d2b66160d248c5a4197f',
#           'sellerID': '0x5ea101f05fe790d8b2678c01d0d161ba6b162a88',
#           'timestamp': 1556239394.944},
#          {'amount': '0.0004380480',
#           'buyerID': '0xab6a0a80c9c3f288f02acaa39343d794a5c5006a',
#           'hash': '0x3af5796fa7ec7c0a4b70491e32db3079ebc69f4da890ae6289e949a6e735c295',
#           'sellerID': '0x5ea101f05fe790d8b2678c01d0d161ba6b162a88',
#           'timestamp': 1556239394.944},
#          {'amount': '0.0004392000',
#           'buyerID': '0xab6a0a80c9c3f288f02acaa39343d794a5c5006a',
#           'hash': '0x3804311038e51c1d57a3a48fadbafb2d6bc27444597665b406955588559f5fd6',
#           'sellerID': '0x5ea101f05fe790d8b2678c01d0d161ba6b162a88',
#           'timestamp': 1556239394.944},
#          {'amount': '0.0004392000',
#           'buyerID': '0xab6a0a80c9c3f288f02acaa39343d794a5c5006a',
#           'hash': '0x5145fc51dfea8540bb0d7369692f835c90e75cc8fedd25c0433a3b255ab591ce',
#           'sellerID': '0x5ea101f05fe790d8b2678c01d0d161ba6b162a88',
#           'timestamp': 1556239404.944},
#          {'amount': '0.0004392000',
#           'buyerID': '0xab6a0a80c9c3f288f02acaa39343d794a5c5006a',
#           'hash': '0x3c89be76333564777c308b33e91353b92ea018dca2d7450c0966607566b006a1',
#           'sellerID': '0x5ea101f05fe790d8b2678c01d0d161ba6b162a88',
#           'timestamp': 1556239404.944},
#          {'amount': '0.0004392000',
#           'buyerID': '0xab6a0a80c9c3f288f02acaa39343d794a5c5006a',
#           'hash': '0x1cfb10a630530c019f663214d6e42ce0c3d8d5c7ffd97daf193e83a1fa605b3c',
#           'sellerID': '0x5ea101f05fe790d8b2678c01d0d161ba6b162a88',
#           'timestamp': 1556239404.944},
#          {'amount': '0.0004392000',
#           'buyerID': '0xab6a0a80c9c3f288f02acaa39343d794a5c5006a',
#           'hash': '0x3faca849018b848b618c4fb2396b5801e308ac0fdd518a921b4d9066e4ff5eab',
#           'sellerID': '0x5ea101f05fe790d8b2678c01d0d161ba6b162a88',
#           'timestamp': 1556239404.944},
#          {'amount': '0.0004392000',
#           'buyerID': '0xab6a0a80c9c3f288f02acaa39343d794a5c5006a',
#           'hash': '0x9117a2620b1cb8878aa82477093047f1f97049314bb4cbada275446d05b73465',
#           'sellerID': '0x5ea101f05fe790d8b2678c01d0d161ba6b162a88',
#           'timestamp': 1556239414.944},
#          {'amount': '0.0004392000',
#           'buyerID': '0xab6a0a80c9c3f288f02acaa39343d794a5c5006a',
#           'hash': '0x586eb611a7bf9c9ab1f2b40e1a7604e1cac7a8893f9fb7ddd3f6abfca80eaa6f',
#           'sellerID': '0x5ea101f05fe790d8b2678c01d0d161ba6b162a88',
#           'timestamp': 1556239414.944},
#          {'amount': '0.0004392000',
#           'buyerID': '0xab6a0a80c9c3f288f02acaa39343d794a5c5006a',
#           'hash': '0x93933b50148ab3f7cdafd105e0308eb7ee93012bc19067dbff8bfe7ec5d7895c',
#           'sellerID': '0x5ea101f05fe790d8b2678c01d0d161ba6b162a88',
#           'timestamp': 1556239414.944},
#          {'amount': '0.0004392000',
#           'buyerID': '0xab6a0a80c9c3f288f02acaa39343d794a5c5006a',
#           'hash': '0x5b6834a11d76b6d425afe1374a902f4ce63486267e25a62a850c81073987900f',
#           'sellerID': '0x5ea101f05fe790d8b2678c01d0d161ba6b162a88',
#           'timestamp': 1556239424.944},
#          {'amount': '0.0004392000',
#           'buyerID': '0xab6a0a80c9c3f288f02acaa39343d794a5c5006a',
#           'hash': '0x9da6d1b4533cb3a819ce75e5cfb74d5720d9495b42fd5625907f61659d9dd0a7',
#           'sellerID': '0x5ea101f05fe790d8b2678c01d0d161ba6b162a88',
#           'timestamp': 1556239424.944},
#          {'amount': '0.0004392000',
#           'buyerID': '0xab6a0a80c9c3f288f02acaa39343d794a5c5006a',
#           'hash': '0x3f4162875fb04ea2a25d319aec62be1e8faa4742f507f978b547a05292b3ba62',
#           'sellerID': '0x5ea101f05fe790d8b2678c01d0d161ba6b162a88',
#           'timestamp': 1556239424.944},
#          {'amount': '0.0004392000',
#           'buyerID': '0xab6a0a80c9c3f288f02acaa39343d794a5c5006a',
#           'hash': '0xd1535b6edee019fccad77149b212d3c40784cf1a55c21b9854c058c7fd229df4',
#           'sellerID': '0x5ea101f05fe790d8b2678c01d0d161ba6b162a88',
#           'timestamp': 1556239424.944},
#          {'amount': '0.0004392000',
#           'buyerID': '0xab6a0a80c9c3f288f02acaa39343d794a5c5006a',
#           'hash': '0x1fb10bb280c2079f19c698785597263019dfd32c1f7c9cb479af6914506afb8d',
#           'sellerID': '0x5ea101f05fe790d8b2678c01d0d161ba6b162a88',
#           'timestamp': 1556239434.944},
#          {'amount': '0.0004392000',
#           'buyerID': '0xab6a0a80c9c3f288f02acaa39343d794a5c5006a',
#           'hash': '0x968c4959296e5a57af1b58cdb7b9edf9f24fc81e328af3cd453d831b0a855f8f',
#           'sellerID': '0x5ea101f05fe790d8b2678c01d0d161ba6b162a88',
#           'timestamp': 1556239434.944},
#          {'amount': '0.0004392000',
#           'buyerID': '0xab6a0a80c9c3f288f02acaa39343d794a5c5006a',
#           'hash': '0x06444ac1763927a313c4971a458a8b540437bd5366643266a0e49827b4c326d8',
#           'sellerID': '0x5ea101f05fe790d8b2678c01d0d161ba6b162a88',
#           'timestamp': 1556239434.944}]}


os.environ['DJANGO_SETTINGS_MODULE'] = 'cpchain_test.settings'
channel_layer = get_channel_layer()


def send_channel_msg(channel_name,data):
    async_to_sync(channel_layer.group_send)(channel_name, {
        'type': 'update_message',
        'message': json.dumps(data),
    })

from .views import wshandler
@cele.task
def hello():
    data =wshandler()
    send_channel_msg('ws_explorer',data)
