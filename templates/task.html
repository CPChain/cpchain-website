{% extends 'base.html' %}
{% load static %}
{% load i18n %}
{% block custom_head %}
<link rel="stylesheet" href="/static/css/explorer.css" content="text/css">

<link href="https://cdn.bootcss.com/jquery.perfect-scrollbar/1.4.0/css/perfect-scrollbar.min.css" rel="stylesheet">
<link rel="profile" href="http://gmpg.org/xfn/11">
<link rel="shortcut icon" href="{% static '/img/favicon.ico' %}" />
<link rel="stylesheet" href="{% static '/css/all.css' %}">
<link rel="stylesheet" href="{% static '/css/swiper.css' %}">
<link href="https://fonts.googleapis.com/css?family=Montserrat:400,500,600,700,800,900|Source+Sans+Pro:400,600,700,900"
    rel="stylesheet">
<link href='https://fonts.googleapis.com/css?family=Poppins' rel='stylesheet'>
{% endblock %}
{% block title %}
<title>Proposals &#8211; CPChain</title>
{% endblock %}
{% block content %}
<style>
    .proposal-container {
        display: flex;
        flex-direction: row;

        overflow: hidden;
        margin-top: 10px;
        margin-bottom: 10px;
        flex-wrap: wrap;
        align-content: flex-start;
        align-items: flex-start;
        ;
        justify-content: flex-start;
    }

    .card {
        width: 270px;
        height: 370px;
        margin: 0 10px;
        position: relative;
        padding: 25px 0;
        margin-bottom: 50px;

        align-items: center;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;

        box-shadow: rgba(48, 82, 120, 0.1) 0 0 9px;
    }

    .title {
        font-size: 1.25rem;
        color: #2e3550;
        letter-spacing: -.34px;
        text-align: center; 
        overflow: hidden;
        text-overflow: ellipsis;
        display: -webkit-box;
        -webkit-box-orient: vertical;
        -webkit-line-clamp: 2;
        padding: 0 10px;
    }


    .type {
        font-size: 1rem;
        color: #a4aab4;
        letter-spacing: -.48px;
        text-align: center;
        margin-top: 20px;
        margin-bottom: 20px;
    }

    .desc {
        font-size: 1rem;
        color: #737d8e;
        letter-spacing: -.27px;
        text-align: center;
        height: 4.6rem;
        box-sizing: border-box;
        padding: 0 10px;
        margin-bottom: 2.65rem;
        line-height: 1.2rem;
        overflow-y: auto;
        overflow: hidden;
        text-overflow: ellipsis;
        display: -webkit-box;
        -webkit-box-orient: vertical;
        -webkit-line-clamp: 4;
    }

    .btn_link {
        display: block;
        width: 18.5rem;
        height: 3.125rem;
        border: 1px solid #abaeb6;
        border-radius: 8px;
        font-size: 1rem;
        color: #2e3550;
        text-align: center;
        line-height: 3.125rem;
        cursor: pointer;
    }

    .more_btn {
        display: block;
        width: 8.5rem;
        height: 2.125rem;
        border: 1px solid #abaeb6;
        border-radius: 3px;
        font-size: .875rem;
        background-color: white;
        color: #2e3550;
        text-align: center;
        line-height: 2.125rem;
        cursor: pointer;
    }


    .main {
        z-index: 10000;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.7);
        display: flex;
        justify-content: center;
        align-items: center;
       
        /* display: none; */
    }

    .mainclose {
        display: none;
    }


    .board {
        display: flex;
        z-index: 100000;
        width: 790px;
        height: 835px;
        border-radius: 10px;

        display: flex;
        flex-direction: row;
        background-color: white;
        padding: 45px;

        flex-direction: column;
        justify-content: space-between;
        align-items: center;

    }

    .row_input {
        width: 100%;
        display: flex;
        flex-direction: row;
    }

    .row_input span {
        width: 150px;
        padding: 0 20px;
    }

    .row_input input {
        flex: 1;
    }

    .row_input select {
        flex: 1;
        background-color: white;
    }


    .row_input textarea {
        flex: 1;
        height: 250px;
    }

    .row_btn {
        width: 100%;
        display: flex;
        flex-direction: row;
        justify-content: space-around;
    }


    .row_btn a {
        display: block;
        width: 12rem;
        height: 3rem;
        border: 1px solid #abaeb6;
        border-radius: 3px;
        font-size: .875rem;
        color: #2e3550;
        text-align: center;
        line-height: 3rem;
        cursor: pointer;
    }

    .disable{
        background-color:#eee
    }
</style>

<body  id="body-list" class="page-template page-template-news page-template-news-php page page-id-15 language-en has-header-image page-two-column colors-light">
 


    <section class="section-seven py-sm-5 py-0 ">
        <div class="container py-sm-5 py-0">
            <div class="row flex-row align-items-center py-5">

                <div class="left-side col-xl-6 col-md-6 col-sm-12">
                    <div class="left-side-holder col-xl-10 col-md-10 col-sm-12 px-0">
                        <h2 class="poppins-font">{% blocktrans %}Building the CPChain ecosystem{% endblocktrans %}</h2>
                        <hr class="right-hr w-100 ml-0">

                    </div>
                </div>
                <div
                    class="right-side col-xl-6 col-lg-6 col-md-6 col-sm-12 d-flex flex-column align-items-end justify-content-between py-5 py-sm-0">
                    <div class="right-side-holder col-xl-9 col-md-9 col-lg-9 col-sm-12 px-0">
                        <p style="color: #305278;font-family: 'Poppins';line-height: 30px;">
                            {% blocktrans %}Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aenean euismod
                            bibendum laoreet. Proin gravida dolor sit amet lacus accumsan et viverra justo commodo.
                            Proin sodales pulvinar sic tempor. Sociis natoque penatibus et magnis dis parturient montes,
                            nascetur ridiculus mus. Nam fermentum, nulla luctus pharetra vulputate, felis tellus mollis
                            orci, sed rhoncus pronin sapien nunc accuan eget.{% endblocktrans %}
                        </p>
                    </div>
                </div>

            </div>
        </div>
    </section>

    <div class="container"  id="task-list" style="margin-bottom: 120px">
        <div id="main" v-if="show" class="main ">
            <div id="board" class="board">
                <h3>Propose</h3>
                <div class="row_input">
                    <span>Title:</span>
                    <input id="Title" type="text">
                </div>
                <div class="row_input">
                    <span>Type:</span>

                    <select id="Type">
                    </select>
                </div>
                <div class="row_input">
                    <span>Description:</span>
                    <textarea id="Description" type="text"></textarea>
                </div>
                <div class="row_input">
                    <span>Proposer:</span>
                    <input id="Proposer" type="text">
                </div>

                <div class="row_btn">
                    <a  v-on:click="cancel()" id="cancel" href="#">CANCEL</a>
                    <a id="submit" href="#" style="background-color:rgb(93, 178, 235) ;">SUBMIT</a>
                </div>

            </div>
        </div>
        <div class="col-12 col-lg-12 "   >
            <div class="table-header">
                <div class="table-header-main">Available Tasks</div>
                <div class="table-header-sub card-link"></div>
            </div>
            <div class="proposal-container">
                <div class="card table-item  " v-for="proposal in available" :key="proposal.id">
                    <p class="title">[[proposal.title]] </p>
                    <p class="type">[[proposal.amount]] cpc</p>
                    <p class="desc">[[proposal.description]] </p>
                    <button  v-on:click="claim(proposal)"   class="more_btn">Claim</button>
                </div>
            </div>

        </div>
        <div class="col-12 col-lg-12">
            <div class="table-header">
                <div class="table-header-main">Developing Tasks</div>
                <div class="table-header-sub card-link"></div>
            </div>
            <div class="     proposal-container">
                <div class="card table-item  " v-for="proposal in development" :key="proposal.id">
                    <p class="title">[[proposal.title]] </p>
                    <p class="type">[[proposal.amount]] cpc</p>
                    <p class="desc">[[proposal.description]]</p>
                   <span class="more_btn disable" >Developing</span> 
                </div>

            </div>
        </div>
        <div class="col-12 col-lg-12">
            <div class="table-header">
                <div class="table-header-main">Completed Tasks</div>
                <div class="table-header-sub card-link"></div>
            </div>
            <div class="   proposal-container">
                <div class="card table-item  " v-for="proposal in completed" :key="proposal.id">
                    <p class="title">[[proposal.title]] </p>
                    <p class="type">[[proposal.amount]] cpc</p>
                    <p class="desc">[[proposal.description]]</p>
                   <span class="more_btn  disable">Completed</span> 
                </div>
            </div>
        </div> 
</div>
    <script src="https://cdn.bootcss.com/jquery/1.12.4/jquery.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/vue/dist/vue.min.js"></script>
    <script src="https://cdn.bootcss.com/jquery.perfect-scrollbar/1.4.0/perfect-scrollbar.min.js"></script>


    <script>

        var cancel = document.getElementById('cancel')
        var submit = document.getElementById('submit')

        cancel.addEventListener('click', function () {
            main.className = 'main mainclose'
        })
        submit.addEventListener('click', function () {
            let obj = {
                title: document.getElementById("Title").value,
                proposal_type: document.getElementById("Type").value,
                description: document.getElementById("Description").value,
                proposer_addr: document.getElementById("Proposer").value
            }

            if (!obj.title) {
                alert('Title is required!')
                return
            }

            if (!obj.description) {
                alert('Description is required!')
                return
            }

            if (!obj.proposer_addr) {
                alert('Proposer is required!')
                return
            }

            fetch(`${serverUrl}community-manage/proposals/`, {
                method: 'POST',
                mode: 'cors',
                headers: {
                    'Content-Type': 'application/json',
                    'accept': 'application/json',
                },
                body: JSON.stringify(obj)
            }).then(res => res.json()).then(result => {
                console.log(result)
                if (result.proposal_id) {
                    main.className = 'main mainclose'
                    alert('Create Proposal Succeeded! Please Remember Id:' + result.proposal_id)
                } else {
                    alert('Create Proposal Failed!')
                }
            })

        })




        const serverUrl = 'https://test.yourserverless.site/'
        const fetchJson = (url) => {
            return fetch(url,
                {
                    method: 'GET',
                    mode: 'cors',
                    headers: {
                        'Content-Type': 'application/json',
                        'accept': 'application/json',
                    }
                }).then(res => res.json())
        }
        let bo = document.getElementById("body-list")
    

        var listApp = new Vue({
            el: '#task-list',
            delimiters: [`[[`, `]]`],
            data: {
                development: [],
                completed: [],
                available: [],
                task:{},
                show: false
            },
            methods: {
                claim:(task) =>{
                    listApp.$data.task = task
                    listApp.$data.show = !listApp.$data.show  
                    if(listApp.$data.show){
                        bo.style.overflow = "hidden";
                    } else {
                        bo.style.overflow = "";
                    }
                },
                cancel:()=>{
                    listApp.$data.task = null
                    listApp.$data.show = !listApp.$data.show  
                    if(listApp.$data.show){
                        bo.style.overflow = "hidden";
                    } else {
                        bo.style.overflow = "";
                    }
                },
                initData: () => {
                    fetchJson(`${serverUrl}community-manage/tasks/?limit=9999&offset=0`).then(res => {
                        listApp.$data.development = res.results.filter(p => p.status == 'development')
                        listApp.$data.completed = res.results.filter(p => p.status == 'completed')
                        listApp.$data.available = res.results.filter(p => p.status == 'available')
                    })

                }
            },
            created() {
                this.initData()
            }
        })




    </script>

</body>
{% endblock %}